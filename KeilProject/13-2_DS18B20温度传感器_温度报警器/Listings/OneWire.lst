C51 COMPILER V9.60.7.0   ONEWIRE                                                           04/27/2024 16:12:28 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE ONEWIRE
OBJECT MODULE PLACED IN .\Objects\OneWire.obj
COMPILER INVOKED BY: D:\Program\MDK51_32\C51\BIN\C51.EXE OneWire.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\L
                    -istings\OneWire.lst) OBJECT(.\Objects\OneWire.obj)

line level    source

   1          #include <REGX52.H>
   2          
   3          // DS18B02å¼•è„šä½å®šä¹‰
   4          sbit OneWire_DQ=P3^7;
   5          
   6          /**
   7            * @brief åˆå§‹åŒ–ï¼š
   8                      ä¸»æœºå°†æ€»çº¿æ‹‰ä½è‡³å°‘480usï¼Œç„¶åé‡Šæ”¾æ€»çº¿ï¼Œç­‰å¾…15~60usåï¼Œå­˜åœ¨çš„ä»æœºä¼šæ
             -‹‰ä½æ€»çº¿60~240usä»¥å“åº”ä¸»æœºï¼Œä¹‹åä»æœºå°†é‡Šæ”¾æ€»çº¿
   9            * @param  æ— 
  10            * @retval Ack ä»æœºåº”ç­”
  11            */
  12          unsigned char OneWire_Init(void)
  13          {
  14   1          // dataç”¨äºå®šä¹‰å­˜å‚¨åœ¨RAMä¸­çš„æ•°æ®ï¼›codeç”¨äºå®šä¹‰å­˜å‚¨åœ¨ROMä¸­çš„ä»£ç 
  15   1          // unsigned char data i;
  16   1          unsigned char i,Ack;
  17   1          EA=0;                       // æ¶ˆé™¤å®šæ—¶å™¨ä¸­æ–­å½±å“
  18   1          OneWire_DQ=1;
  19   1          OneWire_DQ=0;
  20   1          // ç”±STCAI-ISPçš„è½¯ä»¶å»¶æ—¶è®¡ç®—å™¨ç”Ÿæˆï¼šç³»ç»Ÿé¢‘ç‡@11.0592MHzï¼Œ8051æŒ‡ä»¤é›†STC-Y1
  21   1          // ç»æµ‹è¯•ï¼Œå‡½æ•°æœ¬èº«è°ƒç”¨æ—¶é—´ä¸º5usï¼Œ_nop_()å‡½æ•°è°ƒç”¨æ—¶é—´ä¸º1us
  22   1              i = 227;while (--i);        // (500-6)us
  23   1          OneWire_DQ=1;
  24   1          i = 29;while (--i);         // (70-6)us
  25   1          Ack=OneWire_DQ;
  26   1          i = 227;while (--i);        // (500-6)us
  27   1          EA=1;                       // æ¶ˆé™¤å®šæ—¶å™¨ä¸­æ–­å½±å“
  28   1          return Ack;
  29   1      }
  30          
  31          /**
  32            * @brief å‘é€ä¸€ä½ï¼š
  33                      ä¸»æœºå°†æ€»çº¿æ‹‰ä½60~120usï¼Œç„¶åé‡Šæ”¾æ€»çº¿ï¼Œè¡¨ç¤ºå‘é€0ï¼›ä¸»æœºå°†æ€»çº¿æ‹‰ä½1~15
             -usï¼Œç„¶åé‡Šæ”¾æ€»çº¿ï¼Œè¡¨ç¤ºå‘é€1ã€‚
  34                      ä»æœºå°†åœ¨æ€»çº¿æ‹‰ä½30usåï¼ˆå…¸å‹å€¼ï¼‰è¯»å–ç”µå¹³ï¼Œæ•´ä¸ªæ—¶é—´ç‰‡åº”å¤§äº60us
  35            * @param  Bit å‘é€çš„ä½
  36            * @retval æ— 
  37            */
  38          void OneWire_SendBit(unsigned char Bit)
  39          {
  40   1          unsigned char i;  
  41   1          EA=0;                       // æ¶ˆé™¤å®šæ—¶å™¨ä¸­æ–­å½±å“    
  42   1          OneWire_DQ=0;
  43   1          i = 4;while (--i);          // 10us
  44   1          OneWire_DQ=Bit;
  45   1          i = 23;while (--i);         // 50us
  46   1          OneWire_DQ=1;
  47   1          EA=1;                       // æ¶ˆé™¤å®šæ—¶å™¨ä¸­æ–­å½±å“
  48   1      }
  49          
  50          /**
  51            * @brief æ¥æ”¶ä¸€ä½ï¼š
  52                      ä¸»æœºå°†æ€»çº¿æ‹‰ä½1~15usï¼Œç„¶åé‡Šæ”¾æ€»çº¿ï¼Œå¹¶åœ¨æ‹‰ä½å15uså†…è¯»å–æ€»çº¿ç”µå¹³ï¼ˆ
C51 COMPILER V9.60.7.0   ONEWIRE                                                           04/27/2024 16:12:28 PAGE 2   

             -å°½é‡è´´è¿‘15usçš„æœ«å°¾ï¼‰ï¼Œ
  53                      è¯»å–ä¸ºä½ç”µå¹³åˆ™ä¸ºæ¥æ”¶0ï¼Œè¯»å–ä¸ºé«˜ç”µå¹³åˆ™ä¸ºæ¥æ”¶1 ï¼Œæ•´ä¸ªæ—¶é—´ç‰‡åº”å¤§äº6
             -0us
  54            * @param  æ— 
  55            * @retval Bit æ¥æ”¶çš„ä½
  56            */
  57          unsigned char OneWire_ReceiveBit(void)
  58          {
  59   1          unsigned char i,Bit;
  60   1          EA=0;                       // æ¶ˆé™¤å®šæ—¶å™¨ä¸­æ–­å½±å“ 
  61   1          OneWire_DQ=0;
  62   1          i = 2;while (--i);          // 5us
  63   1          OneWire_DQ=1;
  64   1          i = 2;while (--i);          // 5us
  65   1          Bit=OneWire_DQ;
  66   1          i = 23;while (--i);         // 50us
  67   1          EA=1;                       // æ¶ˆé™¤å®šæ—¶å™¨ä¸­æ–­å½±å“
  68   1          return Bit;
  69   1      }
  70          
  71          /**
  72            * @brief å‘é€ä¸€ä¸ªå­—èŠ‚ï¼šè¿ç»­è°ƒç”¨8æ¬¡å‘é€ä¸€ä½çš„æ—¶åºï¼Œä¾æ¬¡å‘é€ä¸€ä¸ªå­—èŠ‚çš„8ä½ï¼ˆ
             -ä½ä½åœ¨å‰ï¼‰
  73            * @param  Byte å‘é€çš„å­—èŠ‚
  74            * @retval æ— 
  75            */
  76          void OneWire_SendByte(unsigned char Byte)
  77          {
  78   1          unsigned char i;
  79   1          for(i=0;i<8;i++)
  80   1          {
  81   2              OneWire_SendBit(Byte&(0x01<<i));
  82   2          }
  83   1      }
  84          
  85          /**
  86            * @brief æ¥æ”¶ä¸€ä¸ªå­—èŠ‚ï¼šè¿ç»­è°ƒç”¨8æ¬¡æ¥æ”¶ä¸€ä½çš„æ—¶åºï¼Œä¾æ¬¡æ¥æ”¶ä¸€ä¸ªå­—èŠ‚çš„8ä½ï¼ˆ
             -ä½ä½åœ¨å‰ï¼‰
  87            * @param  æ— 
  88            * @retval Byte æ¥æ”¶çš„å­—èŠ‚
  89            */
  90          unsigned char OneWire_ReceiveByte(void)
  91          {
  92   1          unsigned char i,Byte=0x00;
  93   1          for(i=0;i<8;i++)
  94   1          {
  95   2              if(OneWire_ReceiveBit()) Byte|=(0x01<<i);
  96   2          }
  97   1          return Byte;
  98   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    134    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
