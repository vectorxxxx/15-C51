C51 COMPILER V9.60.7.0   ONEWIRE                                                           04/27/2024 13:10:58 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE ONEWIRE
OBJECT MODULE PLACED IN .\Objects\OneWire.obj
COMPILER INVOKED BY: D:\Program\MDK51_32\C51\BIN\C51.EXE OneWire.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\L
                    -istings\OneWire.lst) OBJECT(.\Objects\OneWire.obj)

line level    source

   1          #include <REGX52.H>
   2          
   3          // DS18B02å¼•è„šä½å®šä¹‰
   4          sbit OneWire_DQ=P3^7;
   5          
   6          /**
   7            * @brief åˆå§‹åŒ–ï¼š
   8                      ä¸»æœºå°†æ€»çº¿æ‹‰ä½è‡³å°‘480usï¼Œç„¶åé‡Šæ”¾æ€»çº¿ï¼Œç­‰å¾…15~60usåï¼Œå­˜åœ¨çš„ä»æœºä¼šæ
             -‹‰ä½æ€»çº¿60~240usä»¥å“åº”ä¸»æœºï¼Œä¹‹åä»æœºå°†é‡Šæ”¾æ€»çº¿
   9            * @param  æ— 
  10            * @retval Ack ä»æœºåº”ç­”
  11            */
  12          unsigned char OneWire_Init(void)
  13          {
  14   1          // dataç”¨äºå®šä¹‰å­˜å‚¨åœ¨RAMä¸­çš„æ•°æ®ï¼›codeç”¨äºå®šä¹‰å­˜å‚¨åœ¨ROMä¸­çš„ä»£ç 
  15   1          // unsigned char data i;
  16   1          unsigned char i,Ack;
  17   1          OneWire_DQ=1;
  18   1          OneWire_DQ=0;
  19   1          // ç”±STCAI-ISPçš„è½¯ä»¶å»¶æ—¶è®¡ç®—å™¨ç”Ÿæˆï¼šç³»ç»Ÿé¢‘ç‡@11.0592MHzï¼Œ8051æŒ‡ä»¤é›†STC-Y1
  20   1          // ç»æµ‹è¯•ï¼Œå‡½æ•°æœ¬èº«è°ƒç”¨æ—¶é—´ä¸º5usï¼Œ_nop_()å‡½æ•°è°ƒç”¨æ—¶é—´ä¸º1us
  21   1              i = 227;while (--i);        // (500-6)us
  22   1          OneWire_DQ=1;
  23   1          i = 29;while (--i);         // (70-6)us
  24   1          Ack=OneWire_DQ;
  25   1          i = 227;while (--i);        // (500-6)us
  26   1          return Ack;
  27   1      }
  28          
  29          /**
  30            * @brief å‘é€ä¸€ä½ï¼š
  31                      ä¸»æœºå°†æ€»çº¿æ‹‰ä½60~120usï¼Œç„¶åé‡Šæ”¾æ€»çº¿ï¼Œè¡¨ç¤ºå‘é€0ï¼›ä¸»æœºå°†æ€»çº¿æ‹‰ä½1~15
             -usï¼Œç„¶åé‡Šæ”¾æ€»çº¿ï¼Œè¡¨ç¤ºå‘é€1ã€‚
  32                      ä»æœºå°†åœ¨æ€»çº¿æ‹‰ä½30usåï¼ˆå…¸å‹å€¼ï¼‰è¯»å–ç”µå¹³ï¼Œæ•´ä¸ªæ—¶é—´ç‰‡åº”å¤§äº60us
  33            * @param  Bit å‘é€çš„ä½
  34            * @retval æ— 
  35            */
  36          void OneWire_SendBit(unsigned char Bit)
  37          {
  38   1          unsigned char i;    
  39   1          OneWire_DQ=0;
  40   1          i = 4;while (--i);          // 10us
  41   1          OneWire_DQ=Bit;
  42   1          i = 23;while (--i);         // 50us
  43   1          OneWire_DQ=1;
  44   1      }
  45          
  46          /**
  47            * @brief æ¥æ”¶ä¸€ä½ï¼š
  48                      ä¸»æœºå°†æ€»çº¿æ‹‰ä½1~15usï¼Œç„¶åé‡Šæ”¾æ€»çº¿ï¼Œå¹¶åœ¨æ‹‰ä½å15uså†…è¯»å–æ€»çº¿ç”µå¹³ï¼ˆ
             -å°½é‡è´´è¿‘15usçš„æœ«å°¾ï¼‰ï¼Œ
  49                      è¯»å–ä¸ºä½ç”µå¹³åˆ™ä¸ºæ¥æ”¶0ï¼Œè¯»å–ä¸ºé«˜ç”µå¹³åˆ™ä¸ºæ¥æ”¶1 ï¼Œæ•´ä¸ªæ—¶é—´ç‰‡åº”å¤§äº6
             -0us
  50            * @param  æ— 
C51 COMPILER V9.60.7.0   ONEWIRE                                                           04/27/2024 13:10:58 PAGE 2   

  51            * @retval Bit æ¥æ”¶çš„ä½
  52            */
  53          unsigned char OneWire_ReceiveBit(void)
  54          {
  55   1          unsigned char i,Bit;
  56   1          OneWire_DQ=0;
  57   1          i = 2;while (--i);          // 5us
  58   1          OneWire_DQ=1;
  59   1          i = 2;while (--i);          // 5us
  60   1          Bit=OneWire_DQ;
  61   1          i = 23;while (--i);         // 50us
  62   1          return Bit;
  63   1      }
  64          
  65          /**
  66            * @brief å‘é€ä¸€ä¸ªå­—èŠ‚ï¼šè¿ç»­è°ƒç”¨8æ¬¡å‘é€ä¸€ä½çš„æ—¶åºï¼Œä¾æ¬¡å‘é€ä¸€ä¸ªå­—èŠ‚çš„8ä½ï¼ˆ
             -ä½ä½åœ¨å‰ï¼‰
  67            * @param  Byte å‘é€çš„å­—èŠ‚
  68            * @retval æ— 
  69            */
  70          void OneWire_SendByte(unsigned char Byte)
  71          {
  72   1          unsigned char i;
  73   1          for(i=0;i<8;i++)
  74   1          {
  75   2              OneWire_SendBit(Byte&(0x01<<i));
  76   2          }
  77   1      }
  78          
  79          /**
  80            * @brief æ¥æ”¶ä¸€ä¸ªå­—èŠ‚ï¼šè¿ç»­è°ƒç”¨8æ¬¡æ¥æ”¶ä¸€ä½çš„æ—¶åºï¼Œä¾æ¬¡æ¥æ”¶ä¸€ä¸ªå­—èŠ‚çš„8ä½ï¼ˆ
             -ä½ä½åœ¨å‰ï¼‰
  81            * @param  æ— 
  82            * @retval Byte æ¥æ”¶çš„å­—èŠ‚
  83            */
  84          unsigned char OneWire_ReceiveByte(void)
  85          {
  86   1          unsigned char i,Byte=0x00;
  87   1          for(i=0;i<8;i++)
  88   1          {
  89   2              if(OneWire_ReceiveBit()) Byte|=(0x01<<i);
  90   2          }
  91   1          return Byte;
  92   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    122    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
